![image](images/microchip.jpg)

## dsPIC33C Touch CAN LIN Curiosity Development Board - Touch UART OOB Demo

![Board](images/board.png)

## Summary

This project demonstrates the touch functions on dsPIC33C Touch CAN LIN Curiosity Development Board using MCC- Melody driver code.

Demo code will indicate the touch position of the slider via on-board general purpose LEDs. LED1 switches on when the left most slider is pressed. LED 2-3-4-5 switches on as the touch moves towards right. Touch position is also transferred via UART to data visualizer.

The on-board potentiometer position is transferred to data visualizer.

On board general purpose LEDs can also be controlled by sending commands via Data visualizer.

## Related Documentation

[dsPIC33CK1024MP710 datasheet](https://www.microchip.com/dsPIC33CK1024MP710) for more information or specifications.

## Software Used

- [MPLAB® X IDE v6.05](https://www.microchip.com/mplabx) or newer
- [MPLAB® XC16 v2.00](https://www.microchip.com/xc16) or newer
- Device Family Pack : dsPIC33CK-MP_DFP v1.10.341
- [MPLAB® Code Configurator (MCC) 5.2.2](https://www.microchip.com/mcc) or newer
- [MPLAB® Data Visualizer v1.3.1320](https://www.microchip.com/en-us/tools-resources/debug/mplab-data-visualizer) or any other serial terminal

## Hardware Used

- [dsPIC33C Touch CAN LIN Curiosity Development Board](https://www.microchip.com/EV97U97A)

## Setup

**Hardware Setup**

- Connect micro-USB cable to port `J1` of Curiosity board to PC for viewing debug messages.

**MPLAB® X IDE Setup**

- Open the `dspic33c-touch-can-lin-curiosity-touch-uart-oob-demo.X` project in MPLAB® X IDE
- Build and program the device

**Data Visualizer Tool Setup**

- Open standalone or plugin of MPLAB® Data Visualizer
- Select `Variable Streamers` at the left most tabs<br>
  ![data streamer setup 1](images/datastreamer_setup.png)
- Click on `Import` at the top left corner, navigate to `..\dspic33c-touch-can-lin-curiosity-touch-uart-oob-demo.X\mcc_generated_files\data_streamer` and select the `data_streamer.ds` file<br>
  ![data streamer setup 2](images/datastreamer_setup2.png)
- Once the file is opened, a properties window pops up listing the two variables `potValue` which contains potentiometer position and `touchValue` which contains touch position on slider. These two variables are streamed out from the device to the data visualizer via UART. Click on Save<br>
  ![data streamer setup 3](images/datastreamer_setup3.png)
- Once the board is connected to PC, select the appropriate COM source of data streamer under `fx` dropdown.<br>
  ![data streamer setup 4](images/datastreamer_setup4.png)
- Add 2 data axis by clicking plus symbol beside `Add Data Axis` at the `Time Axis` pane.
- For the data axis 1 select `potValue as data_streamer` as source and set the values from 0 to 3.3 . This axis will plot the voltage level of the potentiometer channel.
- For the data axis 2 click on plus symbol beside `Add Plot` select `touchValue as data_streamer` as source and set the values from 0 to 256. Select desired color of the plot to differentiate by clicking on the drop icon. This axis will plot the slider position of the touch.<br>
  ![data streamer view](images/dv_view.png)
- Click on `Show Live Data` on the `Time Plot` view.
- Select `Terminal` view and choose the same COM port as above for sending commands to the device via UART.

## Operation

- When the touch position is at the left most part of the slider, LED1 turns on as the touch of the slider is moved towards right LED2-3-4-5 turns on sequentially. When touch slider is moved from right most to left most these are turned off sequentially.
- The plot of touch position can be viewed on Data Visualizer, plotted as touchValue axis.
- Any variation in the potentiometer voltage is observed on Data Visualizer as potValue axis.
- On-board LEDs can also be controlled from `Line input` of `Terminal` window by sending commands in the format `LEDx ON` or `LEDx OFF` then pressing the `Enter` key. (E.g. LED1 ON\<Press Enter Key\>)<br>
  ![data streamer operation](images/operation.png)

## MCC settings for reference

This Project uses the driver code generated by **MCC-Melody**.

**ADC Configuration (Potentiometer)**

- ADC Configuration done in MCC Melody User Interface for potentiometer handling in this demo. <br>
  ![adc settings](images/adc_mcc.png)

**PIN Configuration**

- UART pins configuration in Pin Grid View: RB14 as UxTX, RB15 as UxRX<br>
  ![uart pin selection](images/pin_grid_uart_mcc.png)
- LED pins configuration in Pin Grid View: RE6, RE7, RE8, RE9 and RF11 as GPIO Output<br>
  ![gp led pin selection](images/pin_grid_led_mcc.png)
- Pins Table view configurations: Custom name of RE6 to `led1`, RE7 to `led2`, RE8 to `led3`, RE9 to `led4` and RF11 to `led5`<br>
  ![gp led custom name](images/pin_table_mcc.png)

**Timer for Touch Application**

- Timer configuration for touch application.<br>
  ![cmd timer settings](images/touch_timer_mcc.png)

**Timer for Input Command Timeout**

- Timer configuration for serial command timeout.<br>
  ![cmd timer settings](images/cmd_timer_mcc.png)
